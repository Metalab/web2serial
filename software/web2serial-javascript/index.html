<html>
  <head>
    <script src="jquery-1.3.min.js"></script>
    <script src="web2serial.js"></script>
    <script>
      var socket;

      function load() {
          web2serial.get_devices(show_devices);
      }

      function show_devices(device_list) {
          // Callback after web2serial.get_devices
          $("#devices").append(JSON.stringify(device_list));

          // Open WebSocket to last device in the list
          var hash = device_list[device_list.length - 1].hash;
          socket = web2serial.open_connection(hash, 9600,  on_message);

          // Handle error event
          socket.onerror = function(event) {
            console.log("onerror");
            console.log(event);
          }

          // Handle close event
          socket.onclose = function(event) {
            console.log("onclose");
            console.log(event);
          }

          // Use `socket.send(web2serial.jsonify(data))` to send stuff to the serial connection
      }

      function on_message(event) {
            console.log("websocket event: " + event.data);
            //$("#messages").html("> " + event.data + "<br>" + $("#messages").html());
        }
    </script>
  </head>

  <body onload="load()">
    <div id="devices">Devices: </div>
    <div id="output"></div>
  </body>
</html>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Augendrogen Web2Serial Demo</title>
  <link rel="stylesheet" href="imports/jquery-ui.css">
  <link rel="stylesheet" href="./styles.css">
  <style>#slider { margin: 10px; }	</style>

  <script src="imports/jquery-2.1.1.min.js"></script>
  <script src="imports/jquery-ui.js"></script>
  <script src="web2serial.js"></script>
  <script src="web2serial-widget.js"></script>




  <script type="text/javascript">
        var widget;

        $(function() {
            widget = new Web2SerialWidget("widget", {
                autoConnect: true,
                deviceExcludeFilter: "n/a",
                baudrate: 9600,
                onopen: function(socket) {
                    // Connection to serial device is established. You can send data either
                    // here with `socket.send(...)`, or via `widget.socket.send(...)`
                    // $("#btn-send").removeAttr('disabled');



                    //neu

                    console.log("OPEN!!");
                    //console.log(device_hash);
                    console.log(socket);
                    //  ws1 = socket;
                    // socket2.send("HELLO");


                    $( "#slider1" ).slider( "option", { disabled: false } );
                    $( "#slider2" ).slider( "option", { disabled: false } );




                },
                onclose: function(event) {
                    // The connection has been closed
                    $( "#slider1" ).slider( "option", { disabled: true } );
                    $( "#slider2" ).slider( "option", { disabled: true } );
                },
                onerror: function(event) {
                    // Error event
                    console.log("ERROR:" + event.error);



                },
                onmessage: function(data) {
                    // Message from the serial device
                    console.log("> " + data);
                }
            });
        });

        </script>




</head>
<body>
<h1>Augendrogen Web2Serial Demo</h1>
<div id="controls"> 
<table align=center border=0 cellspacing=10>
<tr>
<td align=center >LEFT<td/>
<td align=center >RIGHT<td/>
</tr>
<tr>
<td align=center ><div id="slider1_display">1</div><td/>
<td align=center ><div id="slider2_display">1</div><td/>
</tr>
<tr>
<td align=center ><div id="slider1" tabindex=1></div><td/>
<td align=center ><div id="slider2" tabindex=2></div><td/>
</tr>
</table>
</div> 



<div id="widget"></div>

<div id="socket_response"></div>




<script>





$( "#slider1" ).slider({ min:20, max: 200,  slide: slider_slided,  change: slider_changed, orientation: "vertical", disabled: true });
$( "#slider2" ).slider({ min:20, max: 200,  slide: slider_slided,  change: slider_changed, orientation: "vertical", disabled: true });




slider1_value=1;
slider2_value=1;






function slider_changed(event,ui)
{
current_slider = $(ui.handle).parent().attr("id")
eval(current_slider+"_value=ui.value;");

send_serial();

}

function slider_slided(event,ui)
{
current_slider = $(ui.handle).parent().attr("id");
$("#"+current_slider+"_display").html(ui.value);


// instant update on slide .. this can be archived by using cursor keys instead of mouse/touch
//eval(current_slider+"_value=ui.value;");
//send_serial();


}








function send_serial()
{

    var s1 = slider1_value+"";
    while (s1.length < 3) s1 = "0" + s1;

    var s2 = slider2_value+"";
    while (s2.length < 3) s2 = "0" + s2;


    var serialstring = s1 + " " + s2+"\n";
 

 console.log("Sending: " + serialstring);
 widget.socket.send(serialstring);

}













</script>
 




</body>
</html>
